---
testBanner: false
title: "Convert page to GCWeb/Jekyll page tool"
dateModified: 2025-04-30
dateIssued: 2025-04-30
nomenu: true
breadcrumbs: false
feedback: false
share: false
noFooterContextual: true
noFooterCorporate: true
noFooterMain: true
---

<br>
<section>
    <details>
        <summary class="h4">Creating a bookmarklet to launch the convert page to GCWeb/Jekyll page tool</summary>
        <p>This bookmarklet works like a bookmark but will launch the <strong>Convert page to GCWeb/Jekyll page tool</strong> for the current page you are viewing.</p>
        <p>To create a bookmarklet for the <strong>Convert page to GCWeb/Jekyll page tool</strong> right-click the following link and select <strong>Add to favoritesâ€¦</strong> or drag the link to your favorites or favorites bar.</p>
        <ul class="mrgn-tp-md list-unstyled">
            <li><a href="javascript:(function()%7blocation.href='https://cra-design.github.io/core-prototype/core/tools/page-convert-jekyll.html?uri='+encodeURIComponent(location.href);%7d)();">Convert page to GCWeb/Jekyll page tool</a></li>
        </ul>
    </details>
</section>
<div class="clearfix"></div>

<form id="convertform" action="#" accept-charset="UTF-8" enctype="application/x-www-form-urlencoded" method="get">
    <fieldset>
        <legend class="mrgn-bttm-md">Page information</legend>
        <div class="row">
             <div class="form-group">
                <div class="mrgn-lft-md mrgn-tp-lg">
                    <label for="layout"><span class="field-name h3">Layout</span></label>
                </div>
                <select id="layout" name="layout" class="form-control input-lg mrgn-lft-md">
                    <option selected="selected" value="">default</option>
                    <option value="fluid">fluid</option>
                    <option value="no-container">no-container</option>
                    <option value="without-h1">without-h1</option>
<!--
                    <option value="application">application</option>
-->
                </select>
            </div>
            <fieldset class="gc-chckbxrdio">
                <ul class="list-unstyled form-inline lst-spcd-2">
                    <li class="checkbox mrgn-lft-md">
                        <input id="addStyles" type="checkbox" checked="checked">
                        <label for="addStyles">Include all <code>&lt;style&gt;</code> tags</label>
                    </li>
                    <li class="checkbox mrgn-lft-md">
                        <input id="addScripts" type="checkbox" checked="checked">
                        <label for="addScripts">Include all inline <code>&lt;script&gt;</code> tags</label>
                    </li>
                </ul>
            </fieldset>
            <div class="col-lg-12">
                <label class="required control-label mrgn-lft-sm form-input-lg" for="uri">URL <strong class="required">(required)</strong></label>
                <div class="input-group">
                    <input type="url" id="uri" name="uri" class="form-control input-md mrgn-bttm-md full-width" placeholder="Enter a URL" autofocus="autofocus" aria-labelledby="uri" required="required">
                    <span class="input-group-btn">
                        <input id="submitbutton" class="btn btn-primary" type="submit" value="Submit">
                    </span>
                </div>
            </div>
        </div>
    </fieldset>
</form>

<br>

<form id="results" role="form" accept-charset="UTF-8" enctype="application/x-www-form-urlencoded" method="get" action="#">
    <fieldset class="legend-brdr-bttm">
        <legend class="mrgn-bttm-md">Result</legend>
        <div class="form-group">
            <label for="sourcetext" id="contentlabel" class="control-label form-input-lg"><span class="field-name h3">Source:</span></label>
            <!-- START Result textarea -->
            <textarea id="sourcetext" name="content" cols="132" autofocus="autofocus" class="form-control input-md mrgn-bttm-md full-width wb-clipboard" aria-labelledby="contentlabel" aria-multiline="true" rows="23"></textarea>
            <!-- END Result textarea -->
        </div>
<button id="cleartextbtn" class="btn btn-default mrgn-bttm-md mrgn-lft-0"><strong>Clear text</strong></button>
    </fieldset>
</form>

<hr>
<h2>Developer options:</h2>
<p>Enabling will make the developer options visible on all pages that use the Github "testing purposes only" banner.</p>
<ul class="btn-toolbar list-inline" role="toolbar">
    <li class="btn-group">
      <button id="dev_on" class="btn btn-default" type="button"><strong>On</strong></button>
      <button id="dev_off" class="btn btn-default" type="button"><strong>Off</strong></button>
    </li>
    <li class="btn-group"><button id="dev_clear" class="btn btn-default" type="button"><strong>Clear</strong></button></li>
</ul>
<script defer="defer">
    "use strict";

    let jsonFilePath = "https://cra-design.github.io/core-prototype/core/data/template-links.json", 
        getQueryEl = function getQueryEl(field) {
            // Get a querystring value
            const params = new Proxy(new URLSearchParams(window.location.search), {
                get: (searchParams, prop) => searchParams.get(prop),
            });

            return params[field];
        },
        page_url = getQueryEl("uri"),
        generatePage = async function (layout, pageURI) {
            // Generates the GCWeb/Jekyll page
            const parser = new DOMParser();
            let outputVal, altlangObj, breadcrumbLinks, cssLinks, styleElms, scriptElms, mainCode, headerElms, 
                scriptData = "",
                rootDomain = "https://canada.ca",
                absUrlRegEx = new RegExp("((?:<[a-z]+?\\s[^>]*?)(?:(?:href|src|cite|longdesc|action|formaction|poster|icon|manifest|srcset|data(?:-[a-z\\-]+)?)=['\"]))(\\/(?:[^\\/]{1}[^\'\"]+?))(?=['\"][^>]*?>)", "giv"),
                data = await $.get(pageURI), 
//                regexLinkData = await $.get(jsonFilePath), 
                fileLinkArr = await $.get(jsonFilePath), 
//                fileLinkArr = JSON.parse(regexLinkData), 
                result = data.replace(absUrlRegEx, "$1" + rootDomain + "$2"),
                pageObj = parser.parseFromString(result, "text/html"),
                pageTemp = pageObj.cloneNode(true),
                pageTitleObj = pageObj.querySelector("meta[name=dcterms\\.title]"),
                pagelang = pageObj.getElementsByTagName("html")[0].lang,
                breadCrumbObj = pageObj.getElementsByClassName("breadcrumb"),
                pagedetailsEl = pageObj.getElementsByClassName("pagedetails"),
                getMetaDataVal = function getMetaDataVal(pageObj, fieldname, metafield, addQuote) {
                    // Add a Metadata value as a string
                    let encloseQuote = "",
                        metaEl = pageObj.getElementsByName(metafield);

                    if (addQuote === true) {
                        encloseQuote = "\"";
                    }
                    if (metaEl !== null && metaEl.length > 0 && "content" in metaEl[0] === true) {
                        return fieldname + ": " + encloseQuote + metaEl[0].content.trim() + encloseQuote + "\n";
                    }
                    return "";
                },
                islinkInTemplate = function islinkInTemplate(linkArr, checkURL) {
                    // Checks if the <script> or <link> css file is in the JSON file to be ignored from adding to the page 
                    return linkArr.some(function (linkStr) {
                        let linkRegEx = new RegExp(linkStr, "iv");
                        return linkRegEx.test(decodeURIComponent(checkURL.trim()).toLowerCase());
                    }, checkURL);
                };

            outputVal = "---\n";
            // Adds layout
            if (layout !== "") {
                outputVal = outputVal + "layout: " + layout + "\n";
            }
            // Adds title
            if (pageTitleObj !== null && "content" in pageTitleObj === true) {
                outputVal = outputVal + "title: \"" + pageTitleObj.content.trim() + "\"\n";
            }
            // Adds description
            outputVal = outputVal + getMetaDataVal(pageObj, "description", "dcterms.description", true);
            // Adds subject
            outputVal = outputVal + getMetaDataVal(pageObj, "subject", "dcterms.subject", true);
            // Adds keywords
            outputVal = outputVal + getMetaDataVal(pageObj, "keywords", "keywords", true);
            if (pageObj.getElementById("wb-so") !== null) {
                outputVal = outputVal + "auth:\n  type: \"contextual\"\n  label: \"Sign in\"\n  labelExtended: \"CRA sign in\"\n  link: \"https://www.canada.ca/en/revenue-agency/services/e-services/cra-login-services.html\"\n";
            }
            // Adds alternate language link
            if (pagelang === "fr") {
                altlangObj = pageObj.querySelector("link[rel=alternate][hreflang=en]");
            } else if (pagelang === "en") {
                altlangObj = pageObj.querySelector("link[rel=alternate][hreflang=fr]");
            }
            if (altlangObj !== null && typeof altlangObj !== "undefined") {
                outputVal = outputVal + "altLangPage: \"" + altlangObj.href + "\"\n";
            }
            // Adds date modified
            outputVal = outputVal + getMetaDataVal(pageObj, "dateModified", "dcterms.modified", false);
            // Adds date issued
            outputVal = outputVal + getMetaDataVal(pageObj, "dateIssued", "dcterms.issued", false);
            // Adds breadcrumbs
            if (typeof breadCrumbObj !== "undefined" && breadCrumbObj.length > 0) {
                breadcrumbLinks = breadCrumbObj[0].querySelectorAll("a");
                if (breadcrumbLinks.length > 1) {
                    outputVal = outputVal + "breadcrumbs: # By default the Canada.ca crumbs is already set\n";
                    breadcrumbLinks.forEach(function addBreadCrumb(breadLink) {
                        if (breadLink.textContent.toLowerCase() === "canada.ca") {
                            return;
                        }
                        outputVal = outputVal + "  - title: \"" + breadLink.textContent.trim() + "\"\n    link: \"" + breadLink.href + "\"\n";
                    });
                }
            }
            if (pageTemp.getElementsByTagName("main").length > 0) {
                pageTemp.getElementsByTagName("main")[0].remove();
            }
            // Adds links to CSS files
            cssLinks = pageTemp.querySelectorAll("link[rel=stylesheet]");
            for (let cssLink of cssLinks) {
                if (islinkInTemplate(fileLinkArr.stylsheetsRegEx, cssLink.href) === false) {
                    outputVal = outputVal + "css: \"" + cssLink.href + "\"\n";
                }
            }
            // Adds links to script files
            scriptElms = pageTemp.getElementsByTagName("script");
            for (let scriptElm of scriptElms) {
                if (scriptElm.innerHTML !== "") {
                    // Gets any <script> tags outside of the <main> tag and adds them to the bottom of the content
                    if (document.getElementById("addScripts").checked === true) {
                        scriptData = scriptData + scriptElm.outerHTML + "\n";
                    }
                } else if (islinkInTemplate(fileLinkArr.scriptsRegEx, scriptElm.src) === false) {
                    outputVal = outputVal + "script: \"" + scriptElm.src + "\"\n";
                }
            }
            if (pageTitleObj !== null && "content" in pageTitleObj === true) {
//                if (document.querySelector("[data-ajax-replace=/etc/designs/canada/wet-boew/assets/feedback/page-feedback-en.html]").length > 0) {
                outputVal = outputVal + "feedbackData:\n  section: \"" + pageTitleObj.content + "\"\n";
//                }
                // Adds originating URL as sourceurl
                outputVal = outputVal + "soureceurl:\n  - title: \"" + pageTitleObj.content.trim() + "\"\n    link: \"" + pageURI + "\"\n";
            }
            outputVal = outputVal + "---\n\n";
            // Adds any <style> tags outside of the <main> tag and adds them to the bottom of the content
            if (document.getElementById("addStyles").checked === true) {
                styleElms = pageTemp.getElementsByTagName("style");
                for (let styleElm of styleElms) {
                    outputVal = outputVal + styleElm.outerHTML + "\n";
                }
            }
            // Removes page details section 
            for (var i = pagedetailsEl.length - 1; i >= 0; i = i - 1) {
                pagedetailsEl[i].remove();
            }
            // Removes <h1> if layout is not "without-h1"
            if (pageObj.getElementsByTagName("main").length > 0) {
                mainCode = pageObj.getElementsByTagName("main");
                if (layout !== "without-h1") {
                    headerElms = mainCode[0].getElementsByTagName("h1");
                    if (headerElms.length > 0 && headerElms[0].parentNode.tagName.toLowerCase() === "div" && headerElms[0].parentNode.children.length === 1) {
                        headerElms[0].parentNode.remove();
                    } else {
                        headerElms[0].remove();
                    }
                }
                outputVal = outputVal + mainCode[0].innerHTML.trim() + "\n";
            }
            outputVal = outputVal + scriptData;
            return outputVal;
        };

    // submit button
    document.getElementById("submitbutton").addEventListener("click", async function (e) {
        document.getElementById("sourcetext").value = "";
        document.getElementById("sourcetext").value = await generatePage(document.getElementById("layout").value, document.getElementById("uri").value);
        e.stopPropagation();
        e.preventDefault();

        return false;
    });

    // form submit
    document.getElementById("convertform").addEventListener("submit", function (e) {
        e.stopPropagation();
        e.preventDefault();
    });

    // clear text button
    document.getElementById("cleartextbtn").addEventListener("click", function () {
        document.getElementById("sourcetext").value = "";
    });

    // Developer options ON button
    document.getElementById("dev_on").addEventListener("click", function (event) {
        localStorage.setItem("gitCRATemplateDevOptions", true);
    });

    // Developer options OFF button
    document.getElementById("dev_off").addEventListener("click", function (event) {
        localStorage.setItem("gitCRATemplateDevOptions", false);
    });

    // Developer options CLEAR button
    document.getElementById("dev_clear").addEventListener("click", function (event) {
        localStorage.removeItem("gitCRATemplateDevOptions");
    });

    // Initalize function once page finishes loading
    document.addEventListener('DOMContentLoaded', async function () {
        let evt = document.createEvent("MouseEvents"),
            cb = document.getElementById("submitbutton");

        if (page_url !== null && page_url !== "") {
            document.getElementById("uri").value = decodeURIComponent(page_url);
            evt.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
            cb.dispatchEvent(evt);
        }
    }, false);
</script>
